# Maintainer: Omeed Safi <omeed@safi.ms>
pkgbase='osafi'
pkgname=(osafi-base osafi-devel osafi-desktop osafi-dell-xps)
pkgver=1
pkgrel=35
pkgdesc="System configuration for osafi systems"
arch=('any')
url="https://github.com/osafi/arch-pkgs"
license=('MIT')
groups=(osafi)

package_osafi-base() {
    install=osafi-base.install
    
    # Base group
    depends=(bash bzip2 coreutils cryptsetup device-mapper dhcpcd diffutils
    e2fsprogs file filesystem findutils gawk gcc-libs gettext glibc grep gzip
    inetutils iproute2 iputils less licenses linux linux-firmware logrotate lvm2
    man-db man-pages mdadm pacman pciutils perl procps-ng psmisc s-nail sed shadow
    sysfsutils systemd-sysvcompat tar texinfo usbutils util-linux which)
    # Explicitly removed from base group: jsfutils nano netctl reiserfsprogs vi xfsprogs

    # Intel microcode
    depends+=(intel-ucode)

    # File systems
    depends+=(dosfstools exfat-utils ntfs-3g)

    # Extra general packages
    depends+=(bc exa dialog openssh sudo unzip vim)

    install -Dm 0640 ../osafi-base/sudoers \
	"${pkgdir}/etc/sudoers.d/osafi-base"
}

package_osafi-devel() {
    depends=(osafi-base)

    # Base Group
    depends+=(autoconf automake binutils bison fakeroot file findutils flex
    gawk gcc gettext grep groff gzip libtool m4 make pacman patch pkg-config
    sed sudo systemd texinfo util-linux which)

    # General tools
    depends+=(git jq)

    # JetBrains tools
    depends+=(
        jetbrains-toolbox
        libdbusmenu-glib # global menu support
    )

    # Java
    depends+=(
        gradle
        openjdk-src
        jdk-openjdk
        openjdk-doc
    )
}

package_osafi-desktop() {
    install=osafi-desktop.install
    depends=(osafi-base)

    # Login manager
    depends+=(lightdm-webkit-theme-aether xorg-server)

    # Xorg packages and utilities
    depends+=(xorg-xsetroot xorg-xkill xorg-xbacklight xorg-bdftopcf
    xorg-iceauth xorg-luit xorg-mkfontdir xorg-mkfontscale xorg-sessreg
    xorg-setxkbmap xorg-smproxy xorg-x11perf xorg-xauth xorg-xbacklight
    xorg-xcmsdb xorg-xcursorgen xorg-xdpyinfo xorg-xdriinfo xorg-xev
    xorg-xgamma xorg-xhost xorg-xinput xorg-xkbcomp xorg-xkbevd xorg-xkbutils
    xorg-xkill xorg-xlsatoms xorg-xlsclients xorg-xmodmap xorg-xpr xorg-xprop
    xorg-xrandr xorg-xrdb xorg-xrefresh xorg-xset xorg-xsetroot xorg-xvinfo
    xorg-xwd xorg-xwininfo xorg-xwud)

    depends+=(xdg-utils)

    # TODO: polkit authentication agent? mate-polkit

    # TODO: Audio? http://nullwise.com/volumeicon.html
    depends+=(pulseaudio)

    # TODO: Fonts?
    depends+=(nerd-fonts-complete otf-san-francisco)

    # Window manager (BSPWM)
    depends+=(bspwm sxhkd)
    install -Dm 0644 ../osafi-desktop/bspwm/bspwm.desktop \
	"${pkgdir}/usr/share/xsessions/bspwm.desktop.osafi"
    install -Dm 0755 ../osafi-desktop/bspwm/bspwmrc \
	"${pkgdir}/etc/osafi/bspwm/bspwmrc"

    # Hotkey daemon (SXHKD)
    install -Dm 0644 ../osafi-desktop/sxhkd/sxhkdrc \
	"${pkgdir}/etc/osafi/sxhkd/sxhkdrc"
    install -Dm 0744 ../osafi-desktop/sxhkd/10-sxhkd.sh \
    "${pkgdir}/etc/osafi/initrc.d/10-sxhkd.sh"

    # Wallpaper
    depends+=(feh)
    install -Dm 0644 ../osafi-desktop/wallpaper/wallpaper.jpg \
	"${pkgdir}/usr/share/backgrounds/osafi/wallpaper.jpg"
    install -Dm 0744 ../osafi-desktop/wallpaper/90-wallpaper.sh \
    "${pkgdir}/etc/osafi/initrc.d/90-wallpaper.sh"

    # Polybar
    depends+=(polybar)
    install -Dm 0644 ../osafi-desktop/polybar/config \
	"${pkgdir}/etc/osafi/polybar/config"
    install -Dm 0755 ../osafi-desktop/polybar/check-network.sh \
	"${pkgdir}/etc/osafi/polybar/check-network.sh"
    install -Dm 0755 ../osafi-desktop/polybar/powermenu.sh \
	"${pkgdir}/etc/osafi/polybar/powermenu.sh"
    install -Dm 0755 ../osafi-desktop/polybar/launcher.sh \
	"${pkgdir}/etc/osafi/initrc.d/10-polybar.sh"

    # Rofi launcher
    depends+=(rofi)
    install -Dm 0755 ../osafi-desktop/rofi/20-rofi.sh \
	"${pkgdir}/etc/X11/xinit/xinitrc.d/20-rofi.sh"

    # Terminal
    depends+=(rxvt-unicode-patched)
    install -Dm 0755 ../osafi-desktop/urxvt/20-urxvt.sh \
	"${pkgdir}/etc/X11/xinit/xinitrc.d/20-urxvt.sh"
    
    # General applications
    depends+=(google-chrome)
}

package_osafi-dell-xps() {
    install=osafi-dell-xps.install
    depends=(osafi-desktop osafi-devel)

    # Wifi
    depends+=(
	iw
	network-manager-applet
	wireless_tools
	networkmanager
    )

    depends+=(libinput-gestures xf86-input-libinput)

    # Touchpad options + gestures support
    install -Dm 0744 ../osafi-dell-xps/10-libinput-gestures.sh \
    "${pkgdir}/etc/osafi/initrc.d/10-libinput-gestures.sh"
    install -Dm 0644 ../osafi-dell-xps/99-xps-libinput.conf \
	"${pkgdir}/etc/X11/xorg.conf.d/99-xps-libinput.conf"

    install -Dm 0755 ../osafi-dell-xps/20-hidpi.sh \
	"${pkgdir}/etc/X11/xinit/xinitrc.d/20-hidpi.sh"
}
